<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flower Market - –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .screen { padding: 40px 30px; text-align: center; }
        .icon { font-size: 80px; color: #667eea; margin-bottom: 25px; }
        .title { font-size: 32px; color: #333; margin-bottom: 15px; font-weight: 600; }
        .subtitle { font-size: 18px; color: #666; line-height: 1.5; margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto; }
        .btn { background: #4285f4; color: white; border: none; padding: 18px 30px; border-radius: 12px; font-size: 18px; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 15px; margin: 20px 0; transition: all 0.3s ease; width: 100%; max-width: 350px; }
        .btn:hover { background: #3367d6; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(66,133,244,0.3); }
        .btn:disabled { opacity: 0.7; cursor: not-allowed; }
        .form-group { margin-bottom: 25px; text-align: left; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: #333; }
        .form-input { width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; }
        .form-input:focus { border-color: #667eea; outline: none; }
        .form-textarea { min-height: 120px; resize: vertical; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .notification { position: fixed; top: 20px; right: 20px; background: white; border-left: 4px solid #667eea; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-width: 350px; animation: slideIn 0.3s ease; display: none; }
        .notification.error { border-left-color: #ff3b30; }
        .notification.success { border-left-color: #34c759; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .warning-box { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px; padding: 15px; margin: 20px 0; color: #856404; text-align: left; }
        .info-box { background: #e7f3ff; border: 1px solid #b3d7ff; border-radius: 10px; padding: 15px; margin: 20px 0; color: #0066cc; text-align: left; }
        @media (max-width: 768px) {
            .screen { padding: 30px 20px; }
            .title { font-size: 24px; }
            .subtitle { font-size: 16px; }
            .btn { padding: 15px 20px; font-size: 16px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–ê–ì 1: –í–≤–æ–¥ Telegram ID -->
        <div class="screen" id="step1">
            <i class="fas fa-key icon"></i>
            <h1 class="title">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID</h1>
            <p class="subtitle">
                –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ, –Ω–∞–º –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –≤–∞—à Telegram ID
            </p>
            
            <div style="max-width: 400px; margin: 0 auto;">
                <input type="text" id="telegramIdInput" class="form-input" 
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1234567890" 
                       style="margin-bottom: 15px; text-align: center; font-size: 18px;">
                
                <button class="btn" onclick="saveTelegramId()" style="background: #667eea;">
                    <i class="fas fa-check"></i>
                    <span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span>
                </button>
                
                <div class="info-box">
                    <p><strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Telegram ID:</strong></p>
                    <ol style="margin: 10px 0 10px 20px;">
                        <li>–ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É <a href="https://t.me/Flowers_free_bot" target="_blank" style="color: #667eea;">@Flowers_free_bot</a></li>
                        <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code>/id</code></li>
                        <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID (—ç—Ç–æ —á–∏—Å–ª–æ)</li>
                        <li>–í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ –ø–æ–ª–µ –≤—ã—à–µ</li>
                    </ol>
                </div>
                
                <div id="step1Loader" style="display: none;">
                    <div class="loader"></div>
                    <p style="margin-top: 10px; color: #666;">–ü—Ä–æ–≤–µ—Ä—è–µ–º ID...</p>
                </div>
            </div>
        </div>
        
        <!-- –®–ê–ì 2: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google -->
        <div class="screen" id="step2" style="display: none;">
            <i class="fas fa-store icon"></i>
            <h1 class="title">Flower Market</h1>
            <p class="subtitle">
                –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Google, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–¥–∞–∂–µ —Ü–≤–µ—Ç–æ–≤
            </p>
            
            <div id="googleSignInContainer">
                <button class="btn" onclick="signInWithGoogle()" id="googleSignInBtn">
                    <i class="fab fa-google"></i>
                    <span>–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</span>
                </button>
            </div>
            
            <div id="googleButtonContainer" style="margin-top: 20px;"></div>
            
            <div id="authLoader" style="display: none;">
                <div class="loader"></div>
                <p style="margin-top: 10px; color: #666;">–í—Ö–æ–¥–∏–º –≤ –∞–∫–∫–∞—É–Ω—Ç...</p>
            </div>
            
            <p style="color: #666; margin-top: 30px; font-size: 14px;">
                Telegram ID: <span id="currentTelegramId" style="font-weight: bold;"></span>
                <button onclick="changeTelegramId()" style="margin-left: 10px; background: none; border: none; color: #667eea; cursor: pointer; font-size: 12px;">
                    (–∏–∑–º–µ–Ω–∏—Ç—å)
                </button>
            </p>
        </div>
        
        <!-- –®–ê–ì 3: –§–æ—Ä–º–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
        <div class="screen" id="step3" style="display: none; text-align: left;">
            <i class="fas fa-edit icon"></i>
            <h1 class="title">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h1>
            <p class="subtitle" style="text-align: center;">
                –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É, —á—Ç–æ–±—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            </p>
            
            <div class="info-box" style="display: flex; align-items: center; gap: 15px;">
                <div>
                    <h3 id="userName" style="margin: 0;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
                    <p id="userEmail" style="margin: 5px 0 0; color: #666;">email@example.com</p>
                    <p id="userApprovalStatus" style="margin: 5px 0 0; font-size: 14px; color: #666;"></p>
                </div>
            </div>
            
            <form id="adForm" onsubmit="event.preventDefault(); submitAd();">
                <div class="form-group">
                    <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è *</label>
                    <input type="text" id="adTitle" class="form-input" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–≤–µ–∂–∏–µ —Ä–æ–∑—ã, –±—É–∫–µ—Ç –Ω–µ–≤–µ—Å—Ç—ã" 
                           required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                    <textarea id="adDescription" class="form-input form-textarea" 
                              placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ —Ü–≤–µ—Ç—ã, —É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ —Ç.–¥." 
                              required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–¶–µ–Ω–∞ *</label>
                    <input type="text" id="adPrice" class="form-input" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000 —Å–æ–º –∏–ª–∏ –î–æ–≥–æ–≤–æ—Ä–Ω–∞—è" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω *</label>
                    <input type="tel" id="adPhone" class="form-input" 
                           placeholder="+996 XXX XXX XXX" required>
                </div>
                
                <button type="submit" class="btn" id="submitBtn" style="background: #667eea;">
                    <i class="fas fa-paper-plane"></i>
                    <span>–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨ –û–ë–™–Ø–í–õ–ï–ù–ò–ï</span>
                </button>
                
                <div class="warning-box" id="notApprovedWarning" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</strong>
                    <p style="margin: 5px 0 0;">–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –µ—â–µ –Ω–µ –æ–¥–æ–±—Ä–µ–Ω. –û–∂–∏–¥–∞–π—Ç–µ...</p>
                </div>
            </form>
            
            <div id="formLoader" style="display: none; text-align: center;">
                <div class="loader"></div>
                <p style="margin-top: 10px; color: #666;">–ü—É–±–ª–∏–∫—É–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ...</p>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="logout()" style="background: none; border: none; color: #666; cursor: pointer;">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
            </div>
        </div>
        
        <!-- –®–ê–ì 4: –£—Å–ø–µ—Ö -->
        <div class="screen" id="step4" style="display: none;">
            <i class="fas fa-check-circle icon" style="color: #34c759;"></i>
            <h1 class="title">–£—Å–ø–µ—à–Ω–æ!</h1>
            <p class="subtitle" id="successMessage">
                –í–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤ Telegram –∫–∞–Ω–∞–ª–µ!
            </p>
            
            <button class="btn" onclick="createNewAd()" style="background: #667eea; max-width: 250px;">
                <i class="fas fa-plus"></i>
                <span>–°–æ–∑–¥–∞—Ç—å –µ—â–µ –æ–¥–Ω–æ</span>
            </button>
            
            <p style="margin-top: 30px; color: #666; font-size: 14px;">
                <i class="fas fa-info-circle"></i>
                –ß—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞–Ω–∞–ª
                <a href="https://t.me/flowers_market_kg" target="_blank" style="color: #667eea;">@flowers_market_kg</a>
            </p>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>

    <script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        const BACKEND_URL = 'https://backend-flower2-production.up.railway.app';
        const GOOGLE_CLIENT_ID = '316866498988-v1pqivbgh0eupcb9rs53m26nrqukn9hb.apps.googleusercontent.com';
        
        let userId = null;
        let userData = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üå∫ Flower Market –∑–∞–ø—É—â–µ–Ω');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π Telegram ID
            userId = localStorage.getItem('flower_telegram_id');
            
            if (userId) {
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —à–∞–≥ 1, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —à–∞–≥ 2
                document.getElementById('currentTelegramId').textContent = userId;
                showStep(2);
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —à–∞–≥ 1 –¥–ª—è –≤–≤–æ–¥–∞ Telegram ID
                showStep(1);
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google
            if (typeof google !== 'undefined') {
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleGoogleAuthResponse,
                    auto_select: false,
                    ux_mode: 'popup'
                });
                
                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É Google
                google.accounts.id.renderButton(
                    document.getElementById('googleButtonContainer'),
                    { 
                        theme: 'outline', 
                        size: 'large',
                        text: 'continue_with',
                        width: '350'
                    }
                );
            }
        });
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å Telegram ID
        async function saveTelegramId() {
            const input = document.getElementById('telegramIdInput');
            const telegramId = input.value.trim();
            
            if (!telegramId || isNaN(telegramId)) {
                showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Telegram ID (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)', 'error');
                return;
            }
            
            const loader = document.getElementById('step1Loader');
            loader.style.display = 'block';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            try {
                const response = await fetch(`${BACKEND_URL}/api/user/${telegramId}/status`);
                
                if (response.ok) {
                    userId = telegramId;
                    localStorage.setItem('flower_telegram_id', userId);
                    document.getElementById('currentTelegramId').textContent = userId;
                    
                    showStep(2);
                } else {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            } catch (error) {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º ID
                userId = telegramId;
                localStorage.setItem('flower_telegram_id', userId);
                document.getElementById('currentTelegramId').textContent = userId;
                
                showStep(2);
            } finally {
                loader.style.display = 'none';
            }
        }
        
        // –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
        function signInWithGoogle() {
            const googleBtn = document.getElementById('googleSignInBtn');
            const authLoader = document.getElementById('authLoader');
            
            googleBtn.disabled = true;
            googleBtn.style.display = 'none';
            authLoader.style.display = 'block';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º Google Sign-In
            google.accounts.id.prompt();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ Google
        function handleGoogleAuthResponse(response) {
            console.log('‚úÖ Google –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω');
            
            if (response.credential) {
                authenticateWithBackend(response.credential);
            } else {
                showNotification('–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Google', 'error');
                resetGoogleButton();
            }
        }
        
        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±—ç–∫–µ–Ω–¥
        async function authenticateWithBackend(token) {
            try {
                console.log('üîê –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');
                
                const response = await fetch(`${BACKEND_URL}/api/auth/google`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        token: token,
                        telegramUserId: userId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    userData = result.user;
                    console.log('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞:', userData);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    document.getElementById('userName').textContent = userData.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    document.getElementById('userEmail').textContent = userData.email || '';
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–¥–æ–±—Ä–µ–Ω–∏—è
                    await checkApprovalStatus();
                    
                    showStep(3);
                } else {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞', error.message, 'error');
                resetGoogleButton();
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è
        async function checkApprovalStatus() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/user/${userId}/approval-status`);
                if (response.ok) {
                    const data = await response.json();
                    
                    const statusElement = document.getElementById('userApprovalStatus');
                    const warningBox = document.getElementById('notApprovedWarning');
                    const submitBtn = document.getElementById('submitBtn');
                    
                    if (data.isApproved) {
                        statusElement.textContent = '‚úÖ –ê–∫–∫–∞—É–Ω—Ç –æ–¥–æ–±—Ä–µ–Ω';
                        statusElement.style.color = '#34c759';
                        warningBox.style.display = 'none';
                        submitBtn.disabled = false;
                    } else {
                        statusElement.textContent = '‚è≥ –û–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è';
                        statusElement.style.color = '#f39c12';
                        warningBox.style.display = 'block';
                        submitBtn.disabled = true;
                    }
                }
            } catch (error) {
                console.error('Error checking approval:', error);
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        async function submitAd() {
            const title = document.getElementById('adTitle').value.trim();
            const description = document.getElementById('adDescription').value.trim();
            const price = document.getElementById('adPrice').value.trim();
            const phone = document.getElementById('adPhone').value.trim();
            
            if (!title || !description || !price || !phone) {
                showNotification('–û—à–∏–±–∫–∞', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            const formLoader = document.getElementById('formLoader');
            
            submitBtn.disabled = true;
            submitBtn.style.display = 'none';
            formLoader.style.display = 'block';
            
            try {
                const formData = {
                    userId: userId,
                    title: title,
                    description: description,
                    price: price,
                    contactInfo: phone
                };
                
                const response = await fetch(`${BACKEND_URL}/api/publish-ad`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('successMessage').textContent = 
                        result.telegramMessageId 
                            ? '–í–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤ Telegram –∫–∞–Ω–∞–ª–µ!'
                            : '–û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
                    
                    showStep(4);
                } else {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞', error.message, 'error');
                
                submitBtn.disabled = false;
                submitBtn.style.display = 'flex';
                formLoader.style.display = 'none';
            }
        }
        
        // –°–±—Ä–æ—Å –∫–Ω–æ–ø–∫–∏ Google
        function resetGoogleButton() {
            const googleBtn = document.getElementById('googleSignInBtn');
            const authLoader = document.getElementById('authLoader');
            
            if (googleBtn) {
                googleBtn.disabled = false;
                googleBtn.style.display = 'flex';
            }
            if (authLoader) {
                authLoader.style.display = 'none';
            }
        }
        
        // –ò–∑–º–µ–Ω–∏—Ç—å Telegram ID
        function changeTelegramId() {
            localStorage.removeItem('flower_telegram_id');
            userId = null;
            userData = null;
            showStep(1);
        }
        
        // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
        function createNewAd() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('adForm').reset();
            showStep(3);
        }
        
        // –í—ã–π—Ç–∏
        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.removeItem('flower_telegram_id');
                userId = null;
                userData = null;
                showStep(1);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —à–∞–≥
        function showStep(stepNumber) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —à–∞–≥–∏
            for (let i = 1; i <= 4; i++) {
                document.getElementById('step' + i).style.display = 'none';
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π —à–∞–≥
            document.getElementById('step' + stepNumber).style.display = 'block';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center;">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}" 
                       style="color: ${type === 'success' ? '#34c759' : type === 'error' ? '#ff3b30' : '#007aff'}; 
                              margin-right: 10px; font-size: 20px;"></i>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">${title}</div>
                        <div style="color: #666; font-size: 14px;">${message}</div>
                    </div>
                </div>
            `;
            
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>