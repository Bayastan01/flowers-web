<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Flower Market - –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Google API Client -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            padding: 20px; 
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale; 
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        /* –≠–∫—Ä–∞–Ω –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ */
        .form-container {
            padding: 30px;
        }
        
        .contacts-screen {
            text-align: center;
        }
        
        .contacts-icon {
            font-size: 64px;
            color: #667eea;
            margin-bottom: 20px;
            display: block;
        }
        
        .contacts-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .contacts-message {
            font-size: 16px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 25px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .contacts-warning {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 25px 0;
            text-align: left;
            font-size: 14px;
            color: #856404;
        }
        
        .contacts-warning i {
            color: #ffc107;
            margin-right: 10px;
        }
        
        .contacts-required {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 25px 0;
            font-weight: 500;
            color: #667eea;
            font-size: 18px;
        }
        
        /* –û–ø—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ */
        .contact-import-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .contact-import-option {
            padding: 20px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 140px;
        }
        
        .contact-import-option:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
            transform: translateY(-2px);
        }
        
        .contact-import-option.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        .contact-import-option.google-import.active {
            border-color: #4285f4;
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
        }
        
        .contact-import-option i {
            font-size: 32px;
            margin-bottom: 15px;
            display: block;
        }
        
        .contact-import-option p {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .contact-import-option small {
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* –ú–µ—Ç–æ–¥—ã –∏–º–ø–æ—Ä—Ç–∞ */
        .contact-details-input {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
        }
        
        .contact-details-input h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        /* Google —Å—Ç–∏–ª–∏ */
        .google-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 20px auto;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 350px;
        }
        
        .google-btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
        }
        
        .google-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .google-permissions {
            background: rgba(66, 133, 244, 0.1);
            border-left: 4px solid #4285f4;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
        }
        
        .google-permissions h4 {
            color: #4285f4;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .google-permissions ul {
            margin: 10px 0 10px 20px;
            padding: 0;
        }
        
        .google-permissions li {
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        
        /* VCard —Å—Ç–∏–ª–∏ */
        .vcard-upload {
            background: #fff;
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
        }
        
        .vcard-upload:hover {
            background: rgba(102, 126, 234, 0.05);
            border-color: #764ba2;
        }
        
        .vcard-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .vcard-upload p {
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .input-hint {
            color: #666;
            font-size: 14px;
        }
        
        /* –†—É—á–Ω–æ–π –≤–≤–æ–¥ */
        .manual-input-group {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .phone-input-wrapper {
            display: flex;
            align-items: center;
        }
        
        .phone-prefix {
            background: #f8f9fa;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-right: none;
            border-radius: 8px 0 0 8px;
            font-weight: 500;
        }
        
        .phone-input {
            flex: 1;
            border-radius: 0 8px 8px 0 !important;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 350px;
            margin: 10px auto;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        /* –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ */
        .contact-preview {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .contact-preview-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .contact-preview-item:last-child {
            border-bottom: none;
        }
        
        /* –õ–æ–∞–¥–µ—Ä—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .contacts-loader {
            text-align: center;
            padding: 30px;
        }
        
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .contacts-success {
            background: rgba(52, 199, 89, 0.1);
            border-left: 4px solid #34c759;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        
        .contacts-success i {
            color: #34c759;
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        .contacts-error {
            background: rgba(255, 107, 107, 0.1);
            border-left: 4px solid #ff6b6b;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        
        .contacts-error i {
            color: #ff6b6b;
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
        .instructions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
        }
        
        .instructions ol {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            font-size: 14px;
            color: #555;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .contact-import-options {
                grid-template-columns: 1fr;
            }
            
            .form-container {
                padding: 20px;
            }
            
            .contacts-title {
                font-size: 24px;
            }
            
            .contact-details-input {
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 15px;
            }
            
            .btn, .google-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
  <div class="container">
    <!-- –≠–ö–†–ê–ù –ó–ê–ü–†–û–°–ê –ö–û–ù–¢–ê–ö–¢–û–í -->
    <div class="form-container" id="contactsScreen">
        <div class="contacts-screen">
            <i class="fas fa-address-book contacts-icon"></i>
            <h1 class="contacts-title">–î–æ—Å—Ç—É–ø –∫ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–π –∫–Ω–∏–≥–µ</h1>
            
            <p class="contacts-message">
                –î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ Flower Market —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–π —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–π –∫–Ω–∏–≥–µ.<br>
                –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.
            </p>
            
            <div class="contacts-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>–í–∞–∂–Ω–æ:</strong> –ë–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è.
                –ö–æ–Ω—Ç–∞–∫—Ç—ã –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.
            </div>
            
            <div class="contacts-required" id="contactsRequired">
                üì± –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –∏–º–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            </div>
            
            <div class="contact-import-options">
                <div class="contact-import-option active" id="importGoogle" onclick="selectImportMethod('google')">
                    <i class="fab fa-google" style="color: #4285f4;"></i>
                    <p><strong>Google –ö–æ–Ω—Ç–∞–∫—Ç—ã</strong></p>
                    <small>–ë—ã—Å—Ç—Ä—ã–π –∏–º–ø–æ—Ä—Ç</small>
                </div>
                <div class="contact-import-option" id="importVCard" onclick="selectImportMethod('vcard')">
                    <i class="fas fa-file-export"></i>
                    <p><strong>VCard —Ñ–∞–π–ª</strong></p>
                    <small>–≠–∫—Å–ø–æ—Ä—Ç –∏–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞</small>
                </div>
                <div class="contact-import-option" id="importManual" onclick="selectImportMethod('manual')">
                    <i class="fas fa-keyboard"></i>
                    <p><strong>–í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é</strong></p>
                    <small>–ü–æ –æ–¥–Ω–æ–º—É –Ω–æ–º–µ—Ä—É</small>
                </div>
            </div>
            
            <!-- Google Contacts –º–µ—Ç–æ–¥ -->
            <div id="googleMethod" class="contact-details-input">
                <h3 style="margin-bottom: 15px; color: #333;">–ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ Google</h3>
                <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏–∑ –≤–∞—à–µ–≥–æ Google –∞–∫–∫–∞—É–Ω—Ç–∞.
                </p>
                
                <div class="google-permissions">
                    <h4><i class="fab fa-google"></i> –ß—Ç–æ –º—ã –ø–æ–ª—É—á–∏–º:</h4>
                    <ul>
                        <li>‚úÖ –ò–º–µ–Ω–∞ –≤–∞—à–∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</li>
                        <li>‚úÖ –ù–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤</li>
                        <li>‚ùå <strong>–ù–ï</strong> –ø–æ–ª—É—á–∞–µ–º: Email, –∞–¥—Ä–µ—Å–∞, —Ñ–æ—Ç–æ</li>
                        <li>‚ùå <strong>–ù–ï</strong> –ø–æ–ª—É—á–∞–µ–º: –ø–∞—Ä–æ–ª–∏ –∏ –¥–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç–∞</li>
                    </ul>
                    <p style="margin-top: 10px; font-size: 13px; color: #666;">
                        <i class="fas fa-shield-alt"></i> –î–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
                    </p>
                </div>
                
                <button class="google-btn" id="googleSignInBtn" onclick="initGoogleAuth()">
                    <i class="fab fa-google"></i>
                    <span id="googleBtnText">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</span>
                </button>
                
                <div id="googleAuthStatus" style="margin-top: 20px; display: none;">
                    <div class="contacts-success">
                        <i class="fas fa-check-circle"></i>
                        <h4 id="googleStatusTitle">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Google</h4>
                        <p id="googleStatusText">–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ Google –∞–∫–∫–∞—É–Ω—Ç...</p>
                        <div id="googleContactsPreview" class="contact-preview"></div>
                    </div>
                </div>
            </div>
            
            <!-- VCard –º–µ—Ç–æ–¥ -->
            <div id="vcardMethod" class="contact-details-input" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #333;">–ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ VCard —Ñ–∞–π–ª</h3>
                <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏–∑ –≤–∞—à–µ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ VCard —Ñ–∞–π–ª (.vcf) –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ –∑–¥–µ—Å—å.
                </p>
                
                <div class="instructions">
                    <strong><i class="fas fa-mobile-alt"></i> –ö–∞–∫ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã:</strong>
                    <ol>
                        <li><strong>Android:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "–ö–æ–Ω—Ç–∞–∫—Ç—ã" ‚Üí –ú–µ–Ω—é (—Ç—Ä–∏ —Ç–æ—á–∫–∏) ‚Üí –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ ‚Üí –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç ‚Üí –≠–∫—Å–ø–æ—Ä—Ç ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ "VCard —Ñ–∞–π–ª" ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</li>
                        <li><strong>iPhone:</strong> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ö–æ–Ω—Ç–∞–∫—Ç—ã ‚Üí –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∫–∞–∫ vCard ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª—ã</li>
                        <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π .vcf —Ñ–∞–π–ª –Ω–∏–∂–µ</li>
                    </ol>
                </div>
                
                <div class="vcard-upload" onclick="document.getElementById('vcardInput').click()">
                    <i class="fas fa-file-upload vcard-icon"></i>
                    <p><strong>–ó–∞–≥—Ä—É–∑–∏—Ç—å VCard —Ñ–∞–π–ª</strong></p>
                    <p class="input-hint">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ .vcf —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏</p>
                </div>
                <input type="file" id="vcardInput" accept=".vcf,.vcard" style="display: none;" onchange="handleVCardUpload(event)">
                
                <div id="vcardContactsResult" style="margin-top: 20px; display: none;">
                    <div class="contacts-success">
                        <i class="fas fa-check-circle"></i>
                        <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!</h4>
                        <p id="vcardContactsInfo"></p>
                        <div id="vcardContactsPreview" class="contact-preview"></div>
                    </div>
                </div>
            </div>
            
            <!-- –†—É—á–Ω–æ–π –≤–≤–æ–¥ -->
            <div id="manualMethod" class="contact-details-input" style="display: none;">
                <h3 style="margin-bottom: 15px; color: #333;">–í–≤–æ–¥ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤—Ä—É—á–Ω—É—é</h3>
                <p style="margin-bottom: 15px; color: #666; font-size: 14px;">
                    –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏–∑ –≤–∞—à–µ–π —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–π –∫–Ω–∏–≥–∏. –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã 3 –∫–æ–Ω—Ç–∞–∫—Ç–∞.
                </p>
                
                <div class="manual-input-group">
                    <div class="form-group">
                        <label for="contactName">–ò–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞:</label>
                        <input type="text" id="contactName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
                    </div>
                    
                    <div class="form-group">
                        <label for="contactPhone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:</label>
                        <div class="phone-input-wrapper">
                            <span class="phone-prefix">+996</span>
                            <input type="tel" id="contactPhone" class="phone-input" placeholder="XXX XXX XXX">
                        </div>
                    </div>
                    
                    <button class="btn" onclick="addManualContact()">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
                    </button>
                </div>
                
                <div id="manualContactsList" class="contact-preview" style="margin-top: 20px;">
                    <p style="text-align: center; color: #999; padding: 20px;">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</p>
                </div>
                
                <div id="selectedContactsCount" class="contacts-success" style="display: none; margin-top: 15px;">
                    <i class="fas fa-check-circle"></i>
                    –î–æ–±–∞–≤–ª–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: <span id="contactsCountValue">0</span>
                </div>
            </div>
            
            <div class="contacts-loader" id="contactsLoader" style="display: none;">
                <div class="loader" style="width: 40px; height: 40px; margin: 0 auto;"></div>
                <p style="margin-top: 15px; color: #666;" id="loaderText">–ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤...</p>
            </div>
            
            <div id="contactsSuccess" class="contacts-success" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!</h3>
                <p>–ö–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>
                <p style="margin-top: 10px; font-size: 14px;" id="contactsCountText"></p>
                <button class="btn" onclick="continueToForm()" style="margin-top: 15px;">
                    <i class="fas fa-arrow-right"></i> –ü–†–û–î–û–õ–ñ–ò–¢–¨ –ö –°–û–ó–î–ê–ù–ò–Æ –û–ë–™–Ø–í–õ–ï–ù–ò–Ø
                </button>
            </div>
            
            <div id="contactsError" class="contacts-error" style="display: none;">
                <i class="fas fa-exclamation-circle"></i>
                <h3>–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</h3>
                <p id="contactsErrorMessage"></p>
                <button class="btn" onclick="retryContactsRequest()" style="margin-top: 15px; background: #ff6b6b;">
                    <i class="fas fa-redo"></i> –ü–û–í–¢–û–†–ò–¢–¨
                </button>
            </div>
            
            <p style="text-align: center; margin-top: 30px; color: #666; font-size: 14px;">
                <i class="fas fa-shield-alt"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.<br>
                –ú—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º.
            </p>
        </div>
    </div>
    
    <!-- –û–°–ù–û–í–ù–û–ô –§–û–†–ú-–ö–û–ù–¢–ï–ô–ù–ï–† -->
    <div class="form-container" id="mainContainer" style="display: none;">
        <div class="main-container" id="formContainer">
            <!-- –í–∞—à–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –∑–¥–µ—Å—å -->
            <div style="text-align: center; margin-bottom: 30px;">
                <i class="fas fa-store" style="font-size: 64px; color: #667eea; margin-bottom: 20px; display: block;"></i>
                <h1 style="font-size: 28px; color: #333; margin-bottom: 10px;">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–¥–∞–∂–µ —Ü–≤–µ—Ç–æ–≤</h1>
                <p style="color: #666;">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –Ω–∞—à–µ–º –∫–∞–Ω–∞–ª–µ</p>
                <div id="contactsStatusText" style="background: rgba(52, 199, 89, 0.1); padding: 10px 15px; border-radius: 8px; margin-top: 15px; display: inline-block;">
                    <i class="fas fa-check-circle" style="color: #34c759;"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã ‚úì
                </div>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
                <p style="font-size: 18px; color: #333; font-weight: 500;">
                    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –±—É–¥–µ—Ç –∑–¥–µ—Å—å
                </p>
                <p style="color: #666; margin-top: 10px;">
                    –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
                </p>
            </div>
            
            <div style="text-align: center;">
                <button class="btn" onclick="createAd()" style="max-width: 300px;">
                    <i class="fas fa-plus-circle"></i> –°–û–ó–î–ê–¢–¨ –û–ë–™–Ø–í–õ–ï–ù–ò–ï
                </button>
                
                <button class="btn" onclick="backToContacts()" style="max-width: 300px; background: #6c757d; margin-top: 15px;">
                    <i class="fas fa-arrow-left"></i> –í–ï–†–ù–£–¢–¨–°–Ø –ö –ö–û–ù–¢–ê–ö–¢–ê–ú
                </button>
            </div>
        </div>
        
        <div id="successScreen" style="display: none; text-align: center;">
            <div class="contacts-success" style="margin-top: 50px;">
                <i class="fas fa-check-circle" style="font-size: 64px; color: #34c759; margin-bottom: 20px;"></i>
                <h2 style="font-size: 28px; color: #333; margin-bottom: 15px;">–û–±—ä—è–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!</h2>
                <p id="successMessageText" style="color: #666; margin-bottom: 25px;"></p>
                
                <button class="btn" onclick="createNewAd()" style="max-width: 300px;">
                    <i class="fas fa-plus"></i> –°–û–ó–î–ê–¢–¨ –ï–©–ï –û–î–ù–û
                </button>
                
                <button class="btn" onclick="goToChannel()" style="max-width: 300px; background: #4285f4; margin-top: 15px;">
                    <i class="fas fa-external-link-alt"></i> –ü–ï–†–ï–ô–¢–ò –í –ö–ê–ù–ê–õ
                </button>
            </div>
        </div>
    </div>
  </div>

  <script>
// ============================================
// Flower Market - –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ Google API
// ============================================

const BACKEND_URL = 'https://backend-flower-kyrgyz.up.railway.app';
const GOOGLE_CLIENT_ID = '316866498988-v1pqivbgh0eupcb9rs53m26nrqukn9hb.apps.googleusercontent.com';
const GOOGLE_API_KEY = 'AIzaSyABvmdHttTDFwLicTdA5ctg38uTy-H_4B0';

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let userId = null;
let chatId = null;
let contactsUploaded = false;
let contactsCount = 0;
let importMethod = 'google';
let tgWebApp = null;
let importedContacts = [];
let manualContacts = [];
let googleTokenClient = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    console.log('üå∫ Flower Market –∑–∞–ø—É—â–µ–Ω');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram Web App
    try {
        if (window.Telegram && window.Telegram.WebApp) {
            tgWebApp = Telegram.WebApp;
            tgWebApp.ready();
            tgWebApp.expand();
            
            const tgUser = tgWebApp.initDataUnsafe.user;
            if (tgUser) {
                userId = tgUser.id.toString();
                chatId = tgUser.id.toString();
                
                console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram:', { userId, chatId });
            }
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ Telegram Web App:', error);
    }
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram, –∏—Å–ø–æ–ª—å–∑—É–µ–º URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    if (!userId || !chatId) {
        const urlParams = new URLSearchParams(window.location.search);
        userId = urlParams.get('userId');
        chatId = urlParams.get('chatId');
        
        if (userId && chatId) {
            console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:', { userId, chatId });
        }
    }
    
    console.log('üìã –ò—Ç–æ–≥–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', { userId, chatId });
    
    if (!userId || !chatId) {
        showNotification('–û—à–∏–±–∫–∞', '–ù–µ –ø–æ–ª—É—á–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.', 'error');
        return;
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google API
    initGoogleAPI();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
    checkContactsStatus();
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google API
function initGoogleAPI() {
    console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google API...');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google Identity Services
    google.accounts.id.initialize({
        client_id: GOOGLE_CLIENT_ID,
        callback: handleGoogleAuthResponse
    });
    
    console.log('‚úÖ Google API –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
function initGoogleAuth() {
    console.log('üîê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
    
    const googleBtn = document.getElementById('googleSignInBtn');
    const googleBtnText = document.getElementById('googleBtnText');
    
    googleBtn.disabled = true;
    googleBtnText.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
    document.getElementById('googleAuthStatus').style.display = 'block';
    document.getElementById('googleStatusTitle').textContent = '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Google';
    document.getElementById('googleStatusText').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...';
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º Google One Tap
    google.accounts.id.prompt();
    
    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É
    google.accounts.id.renderButton(
        document.getElementById('googleSignInBtn'),
        { 
            theme: 'outline', 
            size: 'large',
            text: 'continue_with',
            shape: 'rectangular',
            logo_alignment: 'left'
        }
    );
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
async function handleGoogleAuthResponse(response) {
    console.log('‚úÖ Google –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞', response);
    
    const googleAuthStatus = document.getElementById('googleAuthStatus');
    const googleStatusTitle = document.getElementById('googleStatusTitle');
    const googleStatusText = document.getElementById('googleStatusText');
    const googleContactsPreview = document.getElementById('googleContactsPreview');
    
    googleStatusTitle.textContent = '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞';
    googleStatusText.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞...';
    
    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –Ω–∞ –±—ç–∫–µ–Ω–¥ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        const authResult = await sendGoogleTokenToBackend(response.credential);
        
        if (authResult.success) {
            googleStatusTitle.textContent = '–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!';
            googleStatusText.textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${authResult.user.name}!`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
            googleAuthStatus.style.background = 'rgba(52, 199, 89, 0.1)';
            googleAuthStatus.style.borderLeftColor = '#34c759';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            const importContactsBtn = document.createElement('button');
            importContactsBtn.className = 'btn';
            importContactsBtn.style.marginTop = '15px';
            importContactsBtn.innerHTML = '<i class="fas fa-download"></i> –ò–ú–ü–û–†–¢–ò–†–û–í–ê–¢–¨ –ö–û–ù–¢–ê–ö–¢–´ –ò–ó GOOGLE';
            importContactsBtn.onclick = () => importGoogleContacts(authResult.user.googleId);
            
            googleAuthStatus.appendChild(importContactsBtn);
            
        } else {
            throw new Error(authResult.error || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
        }
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Google —Ç–æ–∫–µ–Ω–∞:', error);
        
        googleStatusTitle.textContent = '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
        googleStatusText.textContent = error.message;
        googleAuthStatus.style.background = 'rgba(255, 107, 107, 0.1)';
        googleAuthStatus.style.borderLeftColor = '#ff6b6b';
        
        const retryBtn = document.createElement('button');
        retryBtn.className = 'btn';
        retryBtn.style.marginTop = '15px';
        retryBtn.style.background = '#ff6b6b';
        retryBtn.innerHTML = '<i class="fas fa-redo"></i> –ü–û–í–¢–û–†–ò–¢–¨';
        retryBtn.onclick = initGoogleAuth;
        
        googleAuthStatus.appendChild(retryBtn);
    }
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
    const googleBtn = document.getElementById('googleSignInBtn');
    const googleBtnText = document.getElementById('googleBtnText');
    googleBtn.disabled = false;
    googleBtnText.textContent = '–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å';
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ Google —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥
async function sendGoogleTokenToBackend(token) {
    console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ Google —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥...');
    
    const response = await fetch(`${BACKEND_URL}/api/auth/google`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            token: token,
            telegramUserId: userId,
            telegramUsername: tgWebApp?.initDataUnsafe?.user?.username || 'unknown'
        })
    });
    
    if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} - ${errorText}`);
    }
    
    const result = await response.json();
    console.log('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç –±—ç–∫–µ–Ω–¥–∞:', result);
    return result;
}

// –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏–∑ Google
async function importGoogleContacts(googleId) {
    console.log('üìû –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏–∑ Google...');
    
    const googleAuthStatus = document.getElementById('googleAuthStatus');
    const googleStatusTitle = document.getElementById('googleStatusTitle');
    const googleStatusText = document.getElementById('googleStatusText');
    const googleContactsPreview = document.getElementById('googleContactsPreview');
    
    googleStatusText.textContent = '–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏–∑ Google...';
    
    try {
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã –±—ã–ª –∑–∞–ø—Ä–æ—Å –∫ Google People API
        // –ù–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ —Å–æ–∑–¥–∞–¥–∏–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
        
        const testContacts = generateTestContacts();
        
        if (testContacts.length === 0) {
            throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ –≤–∞—à–µ–º Google –∞–∫–∫–∞—É–Ω—Ç–µ');
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
        googleStatusTitle.textContent = '–ö–æ–Ω—Ç–∞–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!';
        googleStatusText.textContent = `–ù–∞–π–¥–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: ${testContacts.length}`;
        
        let previewHtml = '';
        testContacts.slice(0, 5).forEach((contact, index) => {
            previewHtml += `
                <div class="contact-preview-item">
                    <strong>${index + 1}.</strong> ${contact.name}: +${contact.phone}
                </div>
            `;
        });
        
        if (testContacts.length > 5) {
            previewHtml += `
                <div class="contact-preview-item" style="color: #666; font-style: italic;">
                    ... –∏ –µ—â–µ ${testContacts.length - 5} –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
                </div>
            `;
        }
        
        googleContactsPreview.innerHTML = previewHtml;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
        importedContacts = testContacts;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
        const sendButton = document.createElement('button');
        sendButton.className = 'btn';
        sendButton.style.marginTop = '15px';
        sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> –û–¢–ü–†–ê–í–ò–¢–¨ –ö–û–ù–¢–ê–ö–¢–´ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–£';
        sendButton.onclick = () => sendGoogleContactsToServer(testContacts);
        
        googleAuthStatus.appendChild(sendButton);
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ Google:', error);
        
        googleStatusTitle.textContent = '–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞';
        googleStatusText.textContent = error.message;
        googleAuthStatus.style.background = 'rgba(255, 107, 107, 0.1)';
        googleAuthStatus.style.borderLeftColor = '#ff6b6b';
    }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–¥–ª—è –¥–µ–º–æ)
function generateTestContacts() {
    const names = [
        '–ê–π–±–µ–∫ –ê—Å–∞–Ω–æ–≤', '–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞', '–ù—É—Ä–ª–∞–Ω –°–∞–¥—ã–∫–æ–≤', '–ê–π–≥—É–ª—å –¢–æ–∫—Ç–æ—Å—É–Ω–æ–≤–∞',
        '–°–µ—Ä–≥–µ–π –ü–µ—Ç—Ä–æ–≤', '–ê–π—Å—É–ª—É—É –ö—ã–¥—ã—Ä–∞–ª–∏–µ–≤–∞', '–î–º–∏—Ç—Ä–∏–π –°–º–∏—Ä–Ω–æ–≤', '–ñ–∞–∑–≥—É–ª—å –ú–∞–º–∞–µ–≤–∞',
        '–ê–ª–µ–∫—Å–µ–π –ö–æ–≤–∞–ª–µ–≤', '–ì—É–ª–º–∏—Ä–∞ –ê–±–¥—É–ª–ª–∞–µ–≤–∞', '–ö—É—Ç–º–∞–Ω –ö–∞—Å—ã–º–æ–≤', '–ê–ª–∏–Ω–∞ –°–æ–∫–æ–ª–æ–≤–∞',
        '–ë–µ–∫–∂–∞–Ω –¢—É—Ä–≥—É–Ω–æ–≤', '–ï–ª–µ–Ω–∞ –ú–æ—Ä–æ–∑–æ–≤–∞', '–¢–∏–º—É—Ä –ö–∞—Ä–∏–º–æ–≤'
    ];
    
    const contacts = [];
    
    for (let i = 0; i < 8; i++) {
        const name = names[Math.floor(Math.random() * names.length)];
        const phone = '996' + (500000000 + Math.floor(Math.random() * 100000000)).toString();
        
        contacts.push({
            name: name,
            phone: phone,
            rawName: [name],
            rawTel: [phone],
            source: 'google'
        });
    }
    
    return contacts;
}

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å Google –∫–æ–Ω—Ç–∞–∫—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
async function sendGoogleContactsToServer(contacts) {
    if (contacts.length < 3) {
        showNotification('–û—à–∏–±–∫–∞', '–¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 3 –∫–æ–Ω—Ç–∞–∫—Ç–∞', 'error');
        return;
    }
    
    const contactsLoader = document.getElementById('contactsLoader');
    const loaderText = document.getElementById('loaderText');
    
    contactsLoader.style.display = 'block';
    loaderText.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É...';
    document.getElementById('googleMethod').style.display = 'none';
    
    await sendContactsToServer(contacts, 'google');
}

// –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –∏–º–ø–æ—Ä—Ç–∞
function selectImportMethod(method) {
    importMethod = method;
    
    document.querySelectorAll('.contact-import-option').forEach(el => {
        el.classList.remove('active');
    });
    
    const selectedMethod = document.getElementById(`import${method.charAt(0).toUpperCase() + method.slice(1)}`);
    if (selectedMethod) {
        selectedMethod.classList.add('active');
        if (method === 'google') {
            selectedMethod.classList.add('google-import');
        }
    }
    
    document.getElementById('googleMethod').style.display = method === 'google' ? 'block' : 'none';
    document.getElementById('vcardMethod').style.display = method === 'vcard' ? 'block' : 'none';
    document.getElementById('manualMethod').style.display = method === 'manual' ? 'block' : 'none';
    
    document.getElementById('contactsSuccess').style.display = 'none';
    document.getElementById('contactsError').style.display = 'none';
    document.getElementById('googleAuthStatus').style.display = 'none';
}

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
async function checkContactsStatus() {
    try {
        console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤...');
        
        const response = await fetch(`${BACKEND_URL}/api/user/${userId}/status`);
        
        if (response.ok) {
            const data = await response.json();
            console.log('üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:', data);
            
            if (data.hasContacts) {
                contactsUploaded = true;
                contactsCount = data.contactsCount || 0;
                showContactsSuccess();
            } else {
                console.log('‚ÑπÔ∏è –ö–æ–Ω—Ç–∞–∫—Ç—ã –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            }
        } else {
            console.log('‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ VCard —Ñ–∞–π–ª–∞
function handleVCardUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const contactsLoader = document.getElementById('contactsLoader');
    const loaderText = document.getElementById('loaderText');
    const contactsError = document.getElementById('contactsError');
    
    contactsLoader.style.display = 'block';
    loaderText.textContent = '–ß—Ç–µ–Ω–∏–µ VCard —Ñ–∞–π–ª–∞...';
    contactsError.style.display = 'none';
    
    const reader = new FileReader();
    
    reader.onload = async function(e) {
        try {
            loaderText.textContent = '–ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤...';
            
            // –ü–∞—Ä—Å–∏–º VCard —Ñ–∞–π–ª
            const vcardData = e.target.result;
            const contacts = parseVCard(vcardData);
            
            if (contacts.length === 0) {
                throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã.');
            }
            
            if (contacts.length < 3) {
                throw new Error(`–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ ${contacts.length} –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤. –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 3 –∫–æ–Ω—Ç–∞–∫—Ç–∞.`);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
            showVCardContactsPreview(contacts);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ VCard:', error);
            contactsLoader.style.display = 'none';
            contactsError.style.display = 'block';
            document.getElementById('contactsErrorMessage').textContent = error.message;
        }
    };
    
    reader.onerror = function(error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
        contactsLoader.style.display = 'none';
        contactsError.style.display = 'block';
        document.getElementById('contactsErrorMessage').textContent = '–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞';
    };
    
    reader.readAsText(file);
}

// –ü–∞—Ä—Å–µ—Ä VCard —Ñ–∞–π–ª–∞
function parseVCard(vcardData) {
    const contacts = [];
    
    // –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ VCARD –∑–∞–ø–∏—Å–∏
    const vcardEntries = vcardData.split('BEGIN:VCARD');
    
    vcardEntries.forEach(entry => {
        if (!entry.trim() || !entry.includes('END:VCARD')) return;
        
        const lines = entry.split('\n');
        let name = '';
        let phones = [];
        
        lines.forEach(line => {
            const trimmedLine = line.trim();
            
            if (trimmedLine.startsWith('FN:')) {
                name = trimmedLine.substring(3).trim();
            } else if (trimmedLine.startsWith('N:')) {
                const nameParts = trimmedLine.substring(2).trim().split(';');
                if (nameParts.length > 0 && !name) {
                    name = nameParts.slice(0, 2).filter(Boolean).reverse().join(' ').trim();
                }
            } else if (trimmedLine.startsWith('TEL;') || trimmedLine.startsWith('TEL:')) {
                let phone = '';
                
                if (trimmedLine.startsWith('TEL;')) {
                    const parts = trimmedLine.split(':');
                    if (parts.length > 1) {
                        phone = parts[1].trim();
                    }
                } else if (trimmedLine.startsWith('TEL:')) {
                    phone = trimmedLine.substring(4).trim();
                }
                
                // –û—á–∏—â–∞–µ–º –Ω–æ–º–µ—Ä –æ—Ç –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                phone = phone.replace(/\D/g, '');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É –Ω–æ–º–µ—Ä–∞
                if (phone.length >= 10) {
                    phones.push(phone);
                }
            }
        });
        
        if (name && phones.length > 0) {
            phones.forEach(phone => {
                contacts.push({
                    name: name,
                    phone: phone,
                    rawName: [name],
                    rawTel: [phone]
                });
            });
        } else if (phones.length > 0) {
            phones.forEach(phone => {
                contacts.push({
                    name: '–ë–µ–∑ –∏–º–µ–Ω–∏',
                    phone: phone,
                    rawName: ['–ë–µ–∑ –∏–º–µ–Ω–∏'],
                    rawTel: [phone]
                });
            });
        }
    });
    
    return contacts;
}

// –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä VCard –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
function showVCardContactsPreview(contacts) {
    const contactsLoader = document.getElementById('contactsLoader');
    const vcardContactsResult = document.getElementById('vcardContactsResult');
    const vcardContactsInfo = document.getElementById('vcardContactsInfo');
    const vcardContactsPreview = document.getElementById('vcardContactsPreview');
    
    contactsLoader.style.display = 'none';
    importedContacts = contacts;
    
    vcardContactsInfo.textContent = `–ù–∞–π–¥–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: ${contacts.length}`;
    
    let previewHtml = '';
    contacts.slice(0, 5).forEach((contact, index) => {
        const formattedPhone = contact.phone.length > 9 ? 
            `+${contact.phone}` : 
            `+996 ${contact.phone.substring(0, 3)} ${contact.phone.substring(3, 6)} ${contact.phone.substring(6, 9)}`;
        
        previewHtml += `
            <div class="contact-preview-item">
                <strong>${index + 1}.</strong> ${contact.name}: ${formattedPhone}
            </div>
        `;
    });
    
    if (contacts.length > 5) {
        previewHtml += `
            <div class="contact-preview-item" style="color: #666; font-style: italic;">
                ... –∏ –µ—â–µ ${contacts.length - 5} –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            </div>
        `;
    }
    
    vcardContactsPreview.innerHTML = previewHtml;
    vcardContactsResult.style.display = 'block';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
    const sendButton = document.createElement('button');
    sendButton.className = 'btn';
    sendButton.style.marginTop = '15px';
    sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> –û–¢–ü–†–ê–í–ò–¢–¨ –ö–û–ù–¢–ê–ö–¢–´ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–£';
    sendButton.onclick = () => sendVCardContactsToServer();
    
    vcardContactsResult.appendChild(sendButton);
}

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å VCard –∫–æ–Ω—Ç–∞–∫—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
async function sendVCardContactsToServer() {
    if (importedContacts.length < 3) {
        showNotification('–û—à–∏–±–∫–∞', '–¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 3 –∫–æ–Ω—Ç–∞–∫—Ç–∞', 'error');
        return;
    }
    
    const contactsLoader = document.getElementById('contactsLoader');
    const loaderText = document.getElementById('loaderText');
    
    contactsLoader.style.display = 'block';
    loaderText.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É...';
    document.getElementById('vcardMethod').style.display = 'none';
    
    await sendContactsToServer(importedContacts, 'vcard');
}

// –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –≤—Ä—É—á–Ω—É—é
function addManualContact() {
    const nameInput = document.getElementById('contactName');
    const phoneInput = document.getElementById('contactPhone');
    
    const name = nameInput.value.trim();
    const phone = phoneInput.value.trim().replace(/\D/g, '');
    
    if (!name) {
        showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞', 'error');
        return;
    }
    
    if (phone.length !== 9) {
        showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ 9 —Ü–∏—Ñ—Ä –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'error');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π –Ω–æ–º–µ—Ä
    const contactExists = manualContacts.some(c => c.phone === phone);
    if (contactExists) {
        showNotification('–í–Ω–∏–º–∞–Ω–∏–µ', '–≠—Ç–æ—Ç –Ω–æ–º–µ—Ä —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω', 'warning');
        return;
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç
    manualContacts.push({
        name: name,
        phone: phone,
        rawName: [name],
        rawTel: [phone]
    });
    
    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
    nameInput.value = '';
    phoneInput.value = '';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
    updateManualContactsList();
    
    showNotification('–£—Å–ø–µ—à–Ω–æ', '–ö–æ–Ω—Ç–∞–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
}

// –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä—É—á–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
function updateManualContactsList() {
    const contactsList = document.getElementById('manualContactsList');
    const countContainer = document.getElementById('selectedContactsCount');
    const countValue = document.getElementById('contactsCountValue');
    
    if (manualContacts.length === 0) {
        contactsList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</p>';
        countContainer.style.display = 'none';
        return;
    }
    
    let html = '';
    manualContacts.forEach((contact, index) => {
        html += `
            <div class="contact-preview-item">
                <strong>${index + 1}.</strong> ${contact.name}: +996 ${contact.phone.substring(0, 3)} ${contact.phone.substring(3, 6)} ${contact.phone.substring(6, 9)}
                <span onclick="removeManualContact(${index})" style="color: #ff6b6b; float: right; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </span>
            </div>
        `;
    });
    
    contactsList.innerHTML = html;
    countValue.textContent = manualContacts.length;
    countContainer.style.display = 'block';
}

// –£–¥–∞–ª–∏—Ç—å —Ä—É—á–Ω–æ–π –∫–æ–Ω—Ç–∞–∫—Ç
function removeManualContact(index) {
    if (index >= 0 && index < manualContacts.length) {
        manualContacts.splice(index, 1);
        updateManualContactsList();
        showNotification('–£—Å–ø–µ—à–Ω–æ', '–ö–æ–Ω—Ç–∞–∫—Ç —É–¥–∞–ª–µ–Ω', 'success');
    }
}

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä—É—á–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
async function sendManualContactsToServer() {
    if (manualContacts.length < 3) {
        showNotification('–û—à–∏–±–∫–∞', '–¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 3 –∫–æ–Ω—Ç–∞–∫—Ç–∞', 'error');
        return;
    }
    
    const contactsLoader = document.getElementById('contactsLoader');
    const loaderText = document.getElementById('loaderText');
    
    contactsLoader.style.display = 'block';
    loaderText.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É...';
    document.getElementById('manualMethod').style.display = 'none';
    
    await sendContactsToServer(manualContacts, 'manual');
}

// –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
async function sendContactsToServer(contacts, source) {
    const contactsError = document.getElementById('contactsError');
    const contactsErrorMessage = document.getElementById('contactsErrorMessage');
    
    try {
        contactsCount = contacts.length;
        
        console.log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ${contacts.length} –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏–∑ ${source}...`);
        
        const response = await fetch(`${BACKEND_URL}/api/upload-contacts`, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                userId: userId,
                chatId: chatId,
                contacts: contacts,
                firstName: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                importSource: source
            })
        });
        
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} - ${errorText}`);
        }
        
        const result = await response.json();
        console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
        
        if (result.success) {
            contactsUploaded = true;
            document.getElementById('contactsLoader').style.display = 'none';
            showContactsSuccess();
            
            showNotification('‚úÖ –£—Å–ø–µ—à–Ω–æ!', 
                `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${contacts.length} –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.`, 
                'success');
                
        } else {
            throw new Error(result.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤');
        }
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:', error);
        document.getElementById('contactsLoader').style.display = 'none';
        contactsError.style.display = 'block';
        contactsErrorMessage.textContent = error.message;
    }
}

// –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π —ç–∫—Ä–∞–Ω
function showContactsSuccess() {
    document.getElementById('contactsLoader').style.display = 'none';
    document.getElementById('contactsSuccess').style.display = 'block';
    document.getElementById('contactsCountText').textContent = `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: ${contactsCount}`;
    document.getElementById('contactsRequired').innerHTML = '‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç—ã —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!';
    document.getElementById('contactsRequired').style.color = '#34c759';
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
    if (importMethod === 'manual' && manualContacts.length >= 3) {
        const contactsSuccess = document.getElementById('contactsSuccess');
        const sendButton = document.createElement('button');
        sendButton.className = 'btn';
        sendButton.style.marginTop = '15px';
        sendButton.innerHTML = '<i class="fas fa-paper-plane"></i> –û–¢–ü–†–ê–í–ò–¢–¨ –ö–û–ù–¢–ê–ö–¢–´ –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–£';
        sendButton.onclick = sendManualContactsToServer;
        
        const continueBtn = contactsSuccess.querySelector('button[onclick="continueToForm()"]');
        if (continueBtn) {
            continueBtn.parentNode.insertBefore(sendButton, continueBtn);
        }
    }
}

// –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å
function retryContactsRequest() {
    document.getElementById('contactsError').style.display = 'none';
    selectImportMethod('google');
}

// –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫ —Ñ–æ—Ä–º–µ
function continueToForm() {
    if (!contactsUploaded) {
        showNotification('–û—à–∏–±–∫–∞', '–°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É', 'error');
        return;
    }
    
    document.getElementById('contactsScreen').style.display = 'none';
    document.getElementById('mainContainer').style.display = 'block';
    
    document.getElementById('contactsStatusText').innerHTML = 
        `<i class="fas fa-check-circle" style="color: #34c759;"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã: ${contactsCount} ‚úì`;
}

// –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
function createAd() {
    showNotification('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
}

// –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º
function backToContacts() {
    document.getElementById('contactsScreen').style.display = 'block';
    document.getElementById('mainContainer').style.display = 'none';
}

// –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–Ω–∞–ª
function goToChannel() {
    window.open('https://t.me/flowers_market_kg', '_blank');
}

// –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
function createNewAd() {
    document.getElementById('formContainer').style.display = 'block';
    document.getElementById('successScreen').style.display = 'none';
    
    showNotification('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–ì–æ—Ç–æ–≤–æ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –Ω–æ–≤–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è', 'info');
}

// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showNotification(title, message, type = 'info') {
    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        border-left: 4px solid ${type === 'success' ? '#34c759' : type === 'error' ? '#ff3b30' : '#007aff'};
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        max-width: 350px;
        animation: slideIn 0.3s ease;
    `;
    
    notification.innerHTML = `
        <div style="display: flex; align-items: center;">
            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}" 
               style="color: ${type === 'success' ? '#34c759' : type === 'error' ? '#ff3b30' : '#007aff'}; 
                      margin-right: 10px; font-size: 20px;"></i>
            <div>
                <div style="font-weight: 600; margin-bottom: 5px;">${title}</div>
                <div style="color: #666; font-size: 14px;">${message}</div>
            </div>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 5000);
}

// –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);

console.log('‚úÖ Flower Market Frontend –≥–æ—Ç–æ–≤!');
  </script>
</body>
</html>